# 计网----笔记来自哔哩哔哩[你管这破玩意叫网络？](https://www.bilibili.com/video/BV17x6hYZEzJ/?spm_id_from=333.1391.0.0)  

##  集线器：  
1. 作用： 将接受的信息无脑转发到所有出口
2. 实现私聊功能：在集线器中，为了实现私聊功能，给每台电脑都起了一个名字，即 ***mac地址***  
> mac地址，又称物理地址，硬件地址，是每台电脑都独一无二的。长度为48位，前24位为网络硬件制造商的编号，后24位一般是厂家分配的系列号。

如果电脑a需要发送信息给b，只需要在数据包前面加上 ***源mac*** 和 ***目标mac***即可。如此一来，接收方地址看到数据包不是给自己的，拒收即可  
1. 隐患：存在隐患，即其他电脑本质上是可以查看这个数据包的，为此我们需要做出改进  
![1](pic\数据包.png)  

## 交换机
1. 作用：比起集线器多了一个 ***mac地址表***  即，收到一个数据后查看目标mac，直接对应到相应的端口即可  
但要注意，在最初mac地址表空白时其与集线器一般无二，只是会在发送包的过程中自主学习填充mac地址表  
![2](pic\mac地址表.png)  
2. 隐患：  随着连接电脑数量越来越多，维护的mac地址表不可避免的越来越大（即使初期可以通过连接两个交换机来解决，但是由于交换机没有独立地址，映射关系仍然是由端口呈现，故而mac地址表仍然是越来越大的）  
（如下图所示，电脑G和H、E、F在mac地址表中对应都是端口6）  
![3](pic\交换机链接图.png)  
![4](pic\交换机端口映射表.png)  
  
## 路由器
1. 作用：作为一个独立的拥有mac地址的设备，能够帮忙将数据包进行转发（注意路由器两端端口都有独立的mac地址）  
![5](pic\路由器.png)  
如此一来交换机的隐患便解决了，图4变图6  
![6](pic\交换机改良.png)  
2. 问题：如何让A与G的通讯先转发到路由器呢（电脑A怎么知道要转发给路由器呢？）  
3. 解决方法1：从mac地址下手，令左边的mac地址都为ll（left）开头，右边都为rr（rigint）开头。如此一来，在发送数据包时只需要检测目标mac是什么开头就知道是否要发给路由器了  
但是！！！鉴于mac地址由厂家分配（见mac地址概念），鱼龙混杂，再想要按照某个规则来命名mac地址显然不太可能，那该怎么办呢？
4. 解决方法2：既然mac地址行不通了，诶🤓☝，我新定义一个命名规则不就好了----***ip地址***,如此一来，数据包除了要有数据链路层以外，还要有网络层头部，如下图  
![8](pic\数据包2.png)
> ***ip地址***是由32位0101编码构成的，将32位0101编码分为4份，再转化为十进制就是我们常见的ip地址啦；再官方一点，ip地址是由4个8bit（1字节）由0/1组成的数字串，也就是***IP4协议***  
> ![7](pic\ip.png)  
5. 流程：  
   如下图所示  
   若A发给B，由于二者直接连着交换机，只需要将数据发给交换机即可，只需要通过数据链路层。  
   若A发给C，则发送分为两段。首先数据包由A发给路由器，故数据包中的目标mac应该是路由器的mac，而目标ip仍然是C的ip。在路由器接收到数据包之后，路由器会根据C的ip地址来将mac地址更改为C的mac地址，进而进行第二次发送。  
   那么，问题又双叒叕来了，凭什么A知道要先发给路由器啊？凭什么路由器可以根据ip改mac啊？
![9](pic\流程.png)  
6. 解答：
    1. 为什么知道要发给路由器----子网：在同一子网下则发送给交换机，不同子网情况下则发给路由器。
    > ***子网***：对于计算机A来说，ip地址为192.168.0.xx的均为同一子网。如何将这个概念告知计算机呢？  
    > ***子网掩码***：将原ip和目标ip分别与子网掩码进行与运算,若相同则在同一网络，一般会根据网络给予默认ABC三类子网掩码，具体见[csdn子网掩码](https://blog.csdn.net/qq_41207757/article/details/107839099)
    2. 电脑A怎么知道哪个是路由器呢？----默认网关：即给电脑配置路由器IP地址
    3. 那知道了路由器IP，我怎么知道路由器的mac呢？（第一段数据包传送中数据包里只有mac地址是路由器的）----ARP表：ARP表记录了IP与mac地址的对应关系，其表一开始也是空白的，需要像mac地址表一样在发送包的过程中逐渐学习填充。
    4. 那么，第二段传输中路由器如何将包继续传递呢？----路由表：判断目标IP是在哪个端口，并将包发出。其中下一挑地址记录的是其他路由器地址。即，部分包传输过程中需要很多路由器协作才能完成  
![10](pic\路由表.png)  

## 总结
![11](pic\电脑视角.png)  
![12](pic\交换机视角.png)  
![13](pc\路由器视角.png)  
我们一直所说的网络层，也就是IP协议了